<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sysauto_script">
    <sysauto_script action="INSERT_OR_UPDATE">
        <active>true</active>
        <condition/>
        <conditional>false</conditional>
        <name>ttttttttttttttttttttttt</name>
        <run_as display_value="System Administrator">6816f79cc0a8016401c5a33be04be441</run_as>
        <run_as_tz/>
        <run_dayofmonth>1</run_dayofmonth>
        <run_dayofweek>1</run_dayofweek>
        <run_period/>
        <run_start>2018-07-26 12:14:20</run_start>
        <run_time>1969-12-31 23:00:00</run_time>
        <run_type>daily</run_type>
        <script><![CDATA[//var gr = new GlideRecord('imp_user');
var gr = new GlideRecord('sys_user');
gr.initialize(); 

gr.first_name = 'DDD'; 
gr.last_name = "RRR";
gr.email = 'n.aFno@tala.com'; 
gr.mobile_phone =  "33161513133";
gr.user_password.setDisplayValue("123TALAN");
gr.password_needs_reset = true;

var newusername = 	gr.first_name + gr.last_name;

	gr.user_name = newusername;
gr.insert();

// current.variables.pr_nom
// current.variables.pr_nom.getDisplayValue();
// current.variables.pr_nom.getHTMLValue();


function newuser() {

	//gs.log("New User request has been received...parsing email");

	var gr = new GlideRecord('imp_user');

	gr.initialize();

	
	
	gr.first_name = 'aaaa'; 
	gr.last_name = "aaaa";
	
/*
	gr.first_name = current.variables.pr_nom;

	gr.last_name = current.variables.nom;
*/
	// newUser.manager = current.variables.Manager;

	/* Tested username generaters
	newUser.user_name = current.variables.pr_nom + current.variables.nom;
	*/
/*
	
	var firstname = current.variables.pr_nom.toString();

	var lastname = current.variables.nom.toString();
*/
	

	while (unique == false) 
	{
	   newusername = firstname.substring(0,fncurrent).toLowerCase() + lastname.toLowerCase() + lnsuffix;

		//   check for duplicate
		
	   //var gr = new GlideRecord('sys_user');
	   var grr  = new GlideRecord('imp_user');
	   
		grr.addQuery('user_name',newusername);

	   grr.query();

	   if (grr.next()) 

	   if (fncurrent < len) fncurrent = fncurrent + 1; 
	
	   else { lncount = lncount + 1; lnsuffix = lncount; }

	   else 
		    gs.log("Final username " + newusername);
		   unique = true;
	   

   } // end of while loop

	//gr.email = current.variables.adresse_mail;
     gr.email = 'nSSS.aFFFo@talan.com';  /////////////////////////////////////////////
	gr.user_name = newusername;


  
   gr.insert();

} // end of the function ]]></script>
        <sys_class_name>sysauto_script</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2018-07-26 12:15:53</sys_created_on>
        <sys_id>b3c82f9137af13003370dc1873990e1a</sys_id>
        <sys_mod_count>54</sys_mod_count>
        <sys_name>ttttttttttttttttttttttt</sys_name>
        <sys_package display_value="creation_auto_enregistrement_utilisateur_OCA" source="x_248873_creation">fe3fddcd372313003370dc1873990e81</sys_package>
        <sys_policy/>
        <sys_scope display_value="creation_auto_enregistrement_utilisateur_OCA">fe3fddcd372313003370dc1873990e81</sys_scope>
        <sys_update_name>sysauto_script_b3c82f9137af13003370dc1873990e1a</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2018-07-27 07:04:26</sys_updated_on>
        <upgrade_safe>false</upgrade_safe>
    </sysauto_script>
</record_update>
